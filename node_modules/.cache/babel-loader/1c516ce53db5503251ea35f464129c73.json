{"ast":null,"code":"/*!\r\n * express\r\n * Copyright(c) 2009-2013 TJ Holowaychuk\r\n * Copyright(c) 2013 Roman Shtylman\r\n * Copyright(c) 2014-2015 Douglas Christopher Wilson\r\n * MIT Licensed\r\n */\n'use strict';\n/**\r\n * Module dependencies.\r\n * @private\r\n */\n\nrequire(\"core-js/modules/es.error.cause.js\");\n\nrequire(\"core-js/modules/web.immediate.js\");\n\nvar Route = require('./route');\n\nvar Layer = require('./layer');\n\nvar methods = require('methods');\n\nvar mixin = require('utils-merge');\n\nvar debug = require('debug')('express:router');\n\nvar deprecate = require('depd')('express');\n\nvar flatten = require('array-flatten');\n\nvar parseUrl = require('parseurl');\n\nvar setPrototypeOf = require('setprototypeof');\n/**\r\n * Module variables.\r\n * @private\r\n */\n\n\nvar objectRegExp = /^\\[object (\\S+)\\]$/;\nvar slice = Array.prototype.slice;\nvar toString = Object.prototype.toString;\n/**\r\n * Initialize a new `Router` with the given `options`.\r\n *\r\n * @param {Object} [options]\r\n * @return {Router} which is an callable function\r\n * @public\r\n */\n\nvar proto = module.exports = function (options) {\n  var opts = options || {};\n\n  function router(req, res, next) {\n    router.handle(req, res, next);\n  } // mixin Router class functions\n\n\n  setPrototypeOf(router, proto);\n  router.params = {};\n  router._params = [];\n  router.caseSensitive = opts.caseSensitive;\n  router.mergeParams = opts.mergeParams;\n  router.strict = opts.strict;\n  router.stack = [];\n  return router;\n};\n/**\r\n * Map the given param placeholder `name`(s) to the given callback.\r\n *\r\n * Parameter mapping is used to provide pre-conditions to routes\r\n * which use normalized placeholders. For example a _:user_id_ parameter\r\n * could automatically load a user's information from the database without\r\n * any additional code,\r\n *\r\n * The callback uses the same signature as middleware, the only difference\r\n * being that the value of the placeholder is passed, in this case the _id_\r\n * of the user. Once the `next()` function is invoked, just like middleware\r\n * it will continue on to execute the route, or subsequent parameter functions.\r\n *\r\n * Just like in middleware, you must either respond to the request or call next\r\n * to avoid stalling the request.\r\n *\r\n *  app.param('user_id', function(req, res, next, id){\r\n *    User.find(id, function(err, user){\r\n *      if (err) {\r\n *        return next(err);\r\n *      } else if (!user) {\r\n *        return next(new Error('failed to load user'));\r\n *      }\r\n *      req.user = user;\r\n *      next();\r\n *    });\r\n *  });\r\n *\r\n * @param {String} name\r\n * @param {Function} fn\r\n * @return {app} for chaining\r\n * @public\r\n */\n\n\nproto.param = function param(name, fn) {\n  // param logic\n  if (typeof name === 'function') {\n    deprecate('router.param(fn): Refactor to use path params');\n\n    this._params.push(name);\n\n    return;\n  } // apply param functions\n\n\n  var params = this._params;\n  var len = params.length;\n  var ret;\n\n  if (name[0] === ':') {\n    deprecate('router.param(' + JSON.stringify(name) + ', fn): Use router.param(' + JSON.stringify(name.slice(1)) + ', fn) instead');\n    name = name.slice(1);\n  }\n\n  for (var i = 0; i < len; ++i) {\n    if (ret = params[i](name, fn)) {\n      fn = ret;\n    }\n  } // ensure we end up with a\n  // middleware function\n\n\n  if ('function' !== typeof fn) {\n    throw new Error('invalid param() call for ' + name + ', got ' + fn);\n  }\n\n  (this.params[name] = this.params[name] || []).push(fn);\n  return this;\n};\n/**\r\n * Dispatch a req, res into the router.\r\n * @private\r\n */\n\n\nproto.handle = function handle(req, res, out) {\n  var self = this;\n  debug('dispatching %s %s', req.method, req.url);\n  var idx = 0;\n  var protohost = getProtohost(req.url) || '';\n  var removed = '';\n  var slashAdded = false;\n  var sync = 0;\n  var paramcalled = {}; // store options for OPTIONS request\n  // only used if OPTIONS request\n\n  var options = []; // middleware and routes\n\n  var stack = self.stack; // manage inter-router variables\n\n  var parentParams = req.params;\n  var parentUrl = req.baseUrl || '';\n  var done = restore(out, req, 'baseUrl', 'next', 'params'); // setup next layer\n\n  req.next = next; // for options requests, respond with a default if nothing else responds\n\n  if (req.method === 'OPTIONS') {\n    done = wrap(done, function (old, err) {\n      if (err || options.length === 0) return old(err);\n      sendOptionsResponse(res, options, old);\n    });\n  } // setup basic req values\n\n\n  req.baseUrl = parentUrl;\n  req.originalUrl = req.originalUrl || req.url;\n  next();\n\n  function next(err) {\n    var layerError = err === 'route' ? null : err; // remove added slash\n\n    if (slashAdded) {\n      req.url = req.url.slice(1);\n      slashAdded = false;\n    } // restore altered req.url\n\n\n    if (removed.length !== 0) {\n      req.baseUrl = parentUrl;\n      req.url = protohost + removed + req.url.slice(protohost.length);\n      removed = '';\n    } // signal to exit router\n\n\n    if (layerError === 'router') {\n      setImmediate(done, null);\n      return;\n    } // no more matching layers\n\n\n    if (idx >= stack.length) {\n      setImmediate(done, layerError);\n      return;\n    } // max sync stack\n\n\n    if (++sync > 100) {\n      return setImmediate(next, err);\n    } // get pathname of request\n\n\n    var path = getPathname(req);\n\n    if (path == null) {\n      return done(layerError);\n    } // find next matching layer\n\n\n    var layer;\n    var match;\n    var route;\n\n    while (match !== true && idx < stack.length) {\n      layer = stack[idx++];\n      match = matchLayer(layer, path);\n      route = layer.route;\n\n      if (typeof match !== 'boolean') {\n        // hold on to layerError\n        layerError = layerError || match;\n      }\n\n      if (match !== true) {\n        continue;\n      }\n\n      if (!route) {\n        // process non-route handlers normally\n        continue;\n      }\n\n      if (layerError) {\n        // routes do not match with a pending error\n        match = false;\n        continue;\n      }\n\n      var method = req.method;\n\n      var has_method = route._handles_method(method); // build up automatic options response\n\n\n      if (!has_method && method === 'OPTIONS') {\n        appendMethods(options, route._options());\n      } // don't even bother matching route\n\n\n      if (!has_method && method !== 'HEAD') {\n        match = false;\n      }\n    } // no match\n\n\n    if (match !== true) {\n      return done(layerError);\n    } // store route for dispatch on change\n\n\n    if (route) {\n      req.route = route;\n    } // Capture one-time layer values\n\n\n    req.params = self.mergeParams ? mergeParams(layer.params, parentParams) : layer.params;\n    var layerPath = layer.path; // this should be done for the layer\n\n    self.process_params(layer, paramcalled, req, res, function (err) {\n      if (err) {\n        next(layerError || err);\n      } else if (route) {\n        layer.handle_request(req, res, next);\n      } else {\n        trim_prefix(layer, layerError, layerPath, path);\n      }\n\n      sync = 0;\n    });\n  }\n\n  function trim_prefix(layer, layerError, layerPath, path) {\n    if (layerPath.length !== 0) {\n      // Validate path is a prefix match\n      if (layerPath !== path.slice(0, layerPath.length)) {\n        next(layerError);\n        return;\n      } // Validate path breaks on a path separator\n\n\n      var c = path[layerPath.length];\n      if (c && c !== '/' && c !== '.') return next(layerError); // Trim off the part of the url that matches the route\n      // middleware (.use stuff) needs to have the path stripped\n\n      debug('trim prefix (%s) from url %s', layerPath, req.url);\n      removed = layerPath;\n      req.url = protohost + req.url.slice(protohost.length + removed.length); // Ensure leading slash\n\n      if (!protohost && req.url[0] !== '/') {\n        req.url = '/' + req.url;\n        slashAdded = true;\n      } // Setup base URL (no trailing slash)\n\n\n      req.baseUrl = parentUrl + (removed[removed.length - 1] === '/' ? removed.substring(0, removed.length - 1) : removed);\n    }\n\n    debug('%s %s : %s', layer.name, layerPath, req.originalUrl);\n\n    if (layerError) {\n      layer.handle_error(layerError, req, res, next);\n    } else {\n      layer.handle_request(req, res, next);\n    }\n  }\n};\n/**\r\n * Process any parameters for the layer.\r\n * @private\r\n */\n\n\nproto.process_params = function process_params(layer, called, req, res, done) {\n  var params = this.params; // captured parameters from the layer, keys and values\n\n  var keys = layer.keys; // fast track\n\n  if (!keys || keys.length === 0) {\n    return done();\n  }\n\n  var i = 0;\n  var name;\n  var paramIndex = 0;\n  var key;\n  var paramVal;\n  var paramCallbacks;\n  var paramCalled; // process params in order\n  // param callbacks can be async\n\n  function param(err) {\n    if (err) {\n      return done(err);\n    }\n\n    if (i >= keys.length) {\n      return done();\n    }\n\n    paramIndex = 0;\n    key = keys[i++];\n    name = key.name;\n    paramVal = req.params[name];\n    paramCallbacks = params[name];\n    paramCalled = called[name];\n\n    if (paramVal === undefined || !paramCallbacks) {\n      return param();\n    } // param previously called with same value or error occurred\n\n\n    if (paramCalled && (paramCalled.match === paramVal || paramCalled.error && paramCalled.error !== 'route')) {\n      // restore value\n      req.params[name] = paramCalled.value; // next param\n\n      return param(paramCalled.error);\n    }\n\n    called[name] = paramCalled = {\n      error: null,\n      match: paramVal,\n      value: paramVal\n    };\n    paramCallback();\n  } // single param callbacks\n\n\n  function paramCallback(err) {\n    var fn = paramCallbacks[paramIndex++]; // store updated value\n\n    paramCalled.value = req.params[key.name];\n\n    if (err) {\n      // store error\n      paramCalled.error = err;\n      param(err);\n      return;\n    }\n\n    if (!fn) return param();\n\n    try {\n      fn(req, res, paramCallback, paramVal, key.name);\n    } catch (e) {\n      paramCallback(e);\n    }\n  }\n\n  param();\n};\n/**\r\n * Use the given middleware function, with optional path, defaulting to \"/\".\r\n *\r\n * Use (like `.all`) will run for any http METHOD, but it will not add\r\n * handlers for those methods so OPTIONS requests will not consider `.use`\r\n * functions even if they could respond.\r\n *\r\n * The other difference is that _route_ path is stripped and not visible\r\n * to the handler function. The main effect of this feature is that mounted\r\n * handlers can operate without any code changes regardless of the \"prefix\"\r\n * pathname.\r\n *\r\n * @public\r\n */\n\n\nproto.use = function use(fn) {\n  var offset = 0;\n  var path = '/'; // default path to '/'\n  // disambiguate router.use([fn])\n\n  if (typeof fn !== 'function') {\n    var arg = fn;\n\n    while (Array.isArray(arg) && arg.length !== 0) {\n      arg = arg[0];\n    } // first arg is the path\n\n\n    if (typeof arg !== 'function') {\n      offset = 1;\n      path = fn;\n    }\n  }\n\n  var callbacks = flatten(slice.call(arguments, offset));\n\n  if (callbacks.length === 0) {\n    throw new TypeError('Router.use() requires a middleware function');\n  }\n\n  for (var i = 0; i < callbacks.length; i++) {\n    var fn = callbacks[i];\n\n    if (typeof fn !== 'function') {\n      throw new TypeError('Router.use() requires a middleware function but got a ' + gettype(fn));\n    } // add the middleware\n\n\n    debug('use %o %s', path, fn.name || '<anonymous>');\n    var layer = new Layer(path, {\n      sensitive: this.caseSensitive,\n      strict: false,\n      end: false\n    }, fn);\n    layer.route = undefined;\n    this.stack.push(layer);\n  }\n\n  return this;\n};\n/**\r\n * Create a new Route for the given path.\r\n *\r\n * Each route contains a separate middleware stack and VERB handlers.\r\n *\r\n * See the Route api documentation for details on adding handlers\r\n * and middleware to routes.\r\n *\r\n * @param {String} path\r\n * @return {Route}\r\n * @public\r\n */\n\n\nproto.route = function route(path) {\n  var route = new Route(path);\n  var layer = new Layer(path, {\n    sensitive: this.caseSensitive,\n    strict: this.strict,\n    end: true\n  }, route.dispatch.bind(route));\n  layer.route = route;\n  this.stack.push(layer);\n  return route;\n}; // create Router#VERB functions\n\n\nmethods.concat('all').forEach(function (method) {\n  proto[method] = function (path) {\n    var route = this.route(path);\n    route[method].apply(route, slice.call(arguments, 1));\n    return this;\n  };\n}); // append methods to a list of methods\n\nfunction appendMethods(list, addition) {\n  for (var i = 0; i < addition.length; i++) {\n    var method = addition[i];\n\n    if (list.indexOf(method) === -1) {\n      list.push(method);\n    }\n  }\n} // get pathname of request\n\n\nfunction getPathname(req) {\n  try {\n    return parseUrl(req).pathname;\n  } catch (err) {\n    return undefined;\n  }\n} // Get get protocol + host for a URL\n\n\nfunction getProtohost(url) {\n  if (typeof url !== 'string' || url.length === 0 || url[0] === '/') {\n    return undefined;\n  }\n\n  var searchIndex = url.indexOf('?');\n  var pathLength = searchIndex !== -1 ? searchIndex : url.length;\n  var fqdnIndex = url.slice(0, pathLength).indexOf('://');\n  return fqdnIndex !== -1 ? url.substring(0, url.indexOf('/', 3 + fqdnIndex)) : undefined;\n} // get type for error message\n\n\nfunction gettype(obj) {\n  var type = typeof obj;\n\n  if (type !== 'object') {\n    return type;\n  } // inspect [[Class]] for objects\n\n\n  return toString.call(obj).replace(objectRegExp, '$1');\n}\n/**\r\n * Match path to a layer.\r\n *\r\n * @param {Layer} layer\r\n * @param {string} path\r\n * @private\r\n */\n\n\nfunction matchLayer(layer, path) {\n  try {\n    return layer.match(path);\n  } catch (err) {\n    return err;\n  }\n} // merge params with parent params\n\n\nfunction mergeParams(params, parent) {\n  if (typeof parent !== 'object' || !parent) {\n    return params;\n  } // make copy of parent for base\n\n\n  var obj = mixin({}, parent); // simple non-numeric merging\n\n  if (!(0 in params) || !(0 in parent)) {\n    return mixin(obj, params);\n  }\n\n  var i = 0;\n  var o = 0; // determine numeric gaps\n\n  while (i in params) {\n    i++;\n  }\n\n  while (o in parent) {\n    o++;\n  } // offset numeric indices in params before merge\n\n\n  for (i--; i >= 0; i--) {\n    params[i + o] = params[i]; // create holes for the merge when necessary\n\n    if (i < o) {\n      delete params[i];\n    }\n  }\n\n  return mixin(obj, params);\n} // restore obj props after function\n\n\nfunction restore(fn, obj) {\n  var props = new Array(arguments.length - 2);\n  var vals = new Array(arguments.length - 2);\n\n  for (var i = 0; i < props.length; i++) {\n    props[i] = arguments[i + 2];\n    vals[i] = obj[props[i]];\n  }\n\n  return function () {\n    // restore vals\n    for (var i = 0; i < props.length; i++) {\n      obj[props[i]] = vals[i];\n    }\n\n    return fn.apply(this, arguments);\n  };\n} // send an OPTIONS response\n\n\nfunction sendOptionsResponse(res, options, next) {\n  try {\n    var body = options.join(',');\n    res.set('Allow', body);\n    res.send(body);\n  } catch (err) {\n    next(err);\n  }\n} // wrap a function\n\n\nfunction wrap(old, fn) {\n  return function proxy() {\n    var args = new Array(arguments.length + 1);\n    args[0] = old;\n\n    for (var i = 0, len = arguments.length; i < len; i++) {\n      args[i + 1] = arguments[i];\n    }\n\n    fn.apply(this, args);\n  };\n}","map":{"version":3,"names":["Route","require","Layer","methods","mixin","debug","deprecate","flatten","parseUrl","setPrototypeOf","objectRegExp","slice","Array","prototype","toString","Object","proto","module","exports","options","opts","router","req","res","next","handle","params","_params","caseSensitive","mergeParams","strict","stack","param","name","fn","push","len","length","ret","JSON","stringify","i","Error","out","self","method","url","idx","protohost","getProtohost","removed","slashAdded","sync","paramcalled","parentParams","parentUrl","baseUrl","done","restore","wrap","old","err","sendOptionsResponse","originalUrl","layerError","setImmediate","path","getPathname","layer","match","route","matchLayer","has_method","_handles_method","appendMethods","_options","layerPath","process_params","handle_request","trim_prefix","c","substring","handle_error","called","keys","paramIndex","key","paramVal","paramCallbacks","paramCalled","undefined","error","value","paramCallback","e","use","offset","arg","isArray","callbacks","call","arguments","TypeError","gettype","sensitive","end","dispatch","bind","concat","forEach","apply","list","addition","indexOf","pathname","searchIndex","pathLength","fqdnIndex","obj","type","replace","parent","o","props","vals","body","join","set","send","proxy","args"],"sources":["E:/adminDeal/node_modules/express/lib/router/index.js"],"sourcesContent":["/*!\r\n * express\r\n * Copyright(c) 2009-2013 TJ Holowaychuk\r\n * Copyright(c) 2013 Roman Shtylman\r\n * Copyright(c) 2014-2015 Douglas Christopher Wilson\r\n * MIT Licensed\r\n */\r\n\r\n'use strict';\r\n\r\n/**\r\n * Module dependencies.\r\n * @private\r\n */\r\n\r\nvar Route = require('./route');\r\nvar Layer = require('./layer');\r\nvar methods = require('methods');\r\nvar mixin = require('utils-merge');\r\nvar debug = require('debug')('express:router');\r\nvar deprecate = require('depd')('express');\r\nvar flatten = require('array-flatten');\r\nvar parseUrl = require('parseurl');\r\nvar setPrototypeOf = require('setprototypeof')\r\n\r\n/**\r\n * Module variables.\r\n * @private\r\n */\r\n\r\nvar objectRegExp = /^\\[object (\\S+)\\]$/;\r\nvar slice = Array.prototype.slice;\r\nvar toString = Object.prototype.toString;\r\n\r\n/**\r\n * Initialize a new `Router` with the given `options`.\r\n *\r\n * @param {Object} [options]\r\n * @return {Router} which is an callable function\r\n * @public\r\n */\r\n\r\nvar proto = module.exports = function(options) {\r\n  var opts = options || {};\r\n\r\n  function router(req, res, next) {\r\n    router.handle(req, res, next);\r\n  }\r\n\r\n  // mixin Router class functions\r\n  setPrototypeOf(router, proto)\r\n\r\n  router.params = {};\r\n  router._params = [];\r\n  router.caseSensitive = opts.caseSensitive;\r\n  router.mergeParams = opts.mergeParams;\r\n  router.strict = opts.strict;\r\n  router.stack = [];\r\n\r\n  return router;\r\n};\r\n\r\n/**\r\n * Map the given param placeholder `name`(s) to the given callback.\r\n *\r\n * Parameter mapping is used to provide pre-conditions to routes\r\n * which use normalized placeholders. For example a _:user_id_ parameter\r\n * could automatically load a user's information from the database without\r\n * any additional code,\r\n *\r\n * The callback uses the same signature as middleware, the only difference\r\n * being that the value of the placeholder is passed, in this case the _id_\r\n * of the user. Once the `next()` function is invoked, just like middleware\r\n * it will continue on to execute the route, or subsequent parameter functions.\r\n *\r\n * Just like in middleware, you must either respond to the request or call next\r\n * to avoid stalling the request.\r\n *\r\n *  app.param('user_id', function(req, res, next, id){\r\n *    User.find(id, function(err, user){\r\n *      if (err) {\r\n *        return next(err);\r\n *      } else if (!user) {\r\n *        return next(new Error('failed to load user'));\r\n *      }\r\n *      req.user = user;\r\n *      next();\r\n *    });\r\n *  });\r\n *\r\n * @param {String} name\r\n * @param {Function} fn\r\n * @return {app} for chaining\r\n * @public\r\n */\r\n\r\nproto.param = function param(name, fn) {\r\n  // param logic\r\n  if (typeof name === 'function') {\r\n    deprecate('router.param(fn): Refactor to use path params');\r\n    this._params.push(name);\r\n    return;\r\n  }\r\n\r\n  // apply param functions\r\n  var params = this._params;\r\n  var len = params.length;\r\n  var ret;\r\n\r\n  if (name[0] === ':') {\r\n    deprecate('router.param(' + JSON.stringify(name) + ', fn): Use router.param(' + JSON.stringify(name.slice(1)) + ', fn) instead')\r\n    name = name.slice(1)\r\n  }\r\n\r\n  for (var i = 0; i < len; ++i) {\r\n    if (ret = params[i](name, fn)) {\r\n      fn = ret;\r\n    }\r\n  }\r\n\r\n  // ensure we end up with a\r\n  // middleware function\r\n  if ('function' !== typeof fn) {\r\n    throw new Error('invalid param() call for ' + name + ', got ' + fn);\r\n  }\r\n\r\n  (this.params[name] = this.params[name] || []).push(fn);\r\n  return this;\r\n};\r\n\r\n/**\r\n * Dispatch a req, res into the router.\r\n * @private\r\n */\r\n\r\nproto.handle = function handle(req, res, out) {\r\n  var self = this;\r\n\r\n  debug('dispatching %s %s', req.method, req.url);\r\n\r\n  var idx = 0;\r\n  var protohost = getProtohost(req.url) || ''\r\n  var removed = '';\r\n  var slashAdded = false;\r\n  var sync = 0\r\n  var paramcalled = {};\r\n\r\n  // store options for OPTIONS request\r\n  // only used if OPTIONS request\r\n  var options = [];\r\n\r\n  // middleware and routes\r\n  var stack = self.stack;\r\n\r\n  // manage inter-router variables\r\n  var parentParams = req.params;\r\n  var parentUrl = req.baseUrl || '';\r\n  var done = restore(out, req, 'baseUrl', 'next', 'params');\r\n\r\n  // setup next layer\r\n  req.next = next;\r\n\r\n  // for options requests, respond with a default if nothing else responds\r\n  if (req.method === 'OPTIONS') {\r\n    done = wrap(done, function(old, err) {\r\n      if (err || options.length === 0) return old(err);\r\n      sendOptionsResponse(res, options, old);\r\n    });\r\n  }\r\n\r\n  // setup basic req values\r\n  req.baseUrl = parentUrl;\r\n  req.originalUrl = req.originalUrl || req.url;\r\n\r\n  next();\r\n\r\n  function next(err) {\r\n    var layerError = err === 'route'\r\n      ? null\r\n      : err;\r\n\r\n    // remove added slash\r\n    if (slashAdded) {\r\n      req.url = req.url.slice(1)\r\n      slashAdded = false;\r\n    }\r\n\r\n    // restore altered req.url\r\n    if (removed.length !== 0) {\r\n      req.baseUrl = parentUrl;\r\n      req.url = protohost + removed + req.url.slice(protohost.length)\r\n      removed = '';\r\n    }\r\n\r\n    // signal to exit router\r\n    if (layerError === 'router') {\r\n      setImmediate(done, null)\r\n      return\r\n    }\r\n\r\n    // no more matching layers\r\n    if (idx >= stack.length) {\r\n      setImmediate(done, layerError);\r\n      return;\r\n    }\r\n\r\n    // max sync stack\r\n    if (++sync > 100) {\r\n      return setImmediate(next, err)\r\n    }\r\n\r\n    // get pathname of request\r\n    var path = getPathname(req);\r\n\r\n    if (path == null) {\r\n      return done(layerError);\r\n    }\r\n\r\n    // find next matching layer\r\n    var layer;\r\n    var match;\r\n    var route;\r\n\r\n    while (match !== true && idx < stack.length) {\r\n      layer = stack[idx++];\r\n      match = matchLayer(layer, path);\r\n      route = layer.route;\r\n\r\n      if (typeof match !== 'boolean') {\r\n        // hold on to layerError\r\n        layerError = layerError || match;\r\n      }\r\n\r\n      if (match !== true) {\r\n        continue;\r\n      }\r\n\r\n      if (!route) {\r\n        // process non-route handlers normally\r\n        continue;\r\n      }\r\n\r\n      if (layerError) {\r\n        // routes do not match with a pending error\r\n        match = false;\r\n        continue;\r\n      }\r\n\r\n      var method = req.method;\r\n      var has_method = route._handles_method(method);\r\n\r\n      // build up automatic options response\r\n      if (!has_method && method === 'OPTIONS') {\r\n        appendMethods(options, route._options());\r\n      }\r\n\r\n      // don't even bother matching route\r\n      if (!has_method && method !== 'HEAD') {\r\n        match = false;\r\n      }\r\n    }\r\n\r\n    // no match\r\n    if (match !== true) {\r\n      return done(layerError);\r\n    }\r\n\r\n    // store route for dispatch on change\r\n    if (route) {\r\n      req.route = route;\r\n    }\r\n\r\n    // Capture one-time layer values\r\n    req.params = self.mergeParams\r\n      ? mergeParams(layer.params, parentParams)\r\n      : layer.params;\r\n    var layerPath = layer.path;\r\n\r\n    // this should be done for the layer\r\n    self.process_params(layer, paramcalled, req, res, function (err) {\r\n      if (err) {\r\n        next(layerError || err)\r\n      } else if (route) {\r\n        layer.handle_request(req, res, next)\r\n      } else {\r\n        trim_prefix(layer, layerError, layerPath, path)\r\n      }\r\n\r\n      sync = 0\r\n    });\r\n  }\r\n\r\n  function trim_prefix(layer, layerError, layerPath, path) {\r\n    if (layerPath.length !== 0) {\r\n      // Validate path is a prefix match\r\n      if (layerPath !== path.slice(0, layerPath.length)) {\r\n        next(layerError)\r\n        return\r\n      }\r\n\r\n      // Validate path breaks on a path separator\r\n      var c = path[layerPath.length]\r\n      if (c && c !== '/' && c !== '.') return next(layerError)\r\n\r\n      // Trim off the part of the url that matches the route\r\n      // middleware (.use stuff) needs to have the path stripped\r\n      debug('trim prefix (%s) from url %s', layerPath, req.url);\r\n      removed = layerPath;\r\n      req.url = protohost + req.url.slice(protohost.length + removed.length)\r\n\r\n      // Ensure leading slash\r\n      if (!protohost && req.url[0] !== '/') {\r\n        req.url = '/' + req.url;\r\n        slashAdded = true;\r\n      }\r\n\r\n      // Setup base URL (no trailing slash)\r\n      req.baseUrl = parentUrl + (removed[removed.length - 1] === '/'\r\n        ? removed.substring(0, removed.length - 1)\r\n        : removed);\r\n    }\r\n\r\n    debug('%s %s : %s', layer.name, layerPath, req.originalUrl);\r\n\r\n    if (layerError) {\r\n      layer.handle_error(layerError, req, res, next);\r\n    } else {\r\n      layer.handle_request(req, res, next);\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Process any parameters for the layer.\r\n * @private\r\n */\r\n\r\nproto.process_params = function process_params(layer, called, req, res, done) {\r\n  var params = this.params;\r\n\r\n  // captured parameters from the layer, keys and values\r\n  var keys = layer.keys;\r\n\r\n  // fast track\r\n  if (!keys || keys.length === 0) {\r\n    return done();\r\n  }\r\n\r\n  var i = 0;\r\n  var name;\r\n  var paramIndex = 0;\r\n  var key;\r\n  var paramVal;\r\n  var paramCallbacks;\r\n  var paramCalled;\r\n\r\n  // process params in order\r\n  // param callbacks can be async\r\n  function param(err) {\r\n    if (err) {\r\n      return done(err);\r\n    }\r\n\r\n    if (i >= keys.length ) {\r\n      return done();\r\n    }\r\n\r\n    paramIndex = 0;\r\n    key = keys[i++];\r\n    name = key.name;\r\n    paramVal = req.params[name];\r\n    paramCallbacks = params[name];\r\n    paramCalled = called[name];\r\n\r\n    if (paramVal === undefined || !paramCallbacks) {\r\n      return param();\r\n    }\r\n\r\n    // param previously called with same value or error occurred\r\n    if (paramCalled && (paramCalled.match === paramVal\r\n      || (paramCalled.error && paramCalled.error !== 'route'))) {\r\n      // restore value\r\n      req.params[name] = paramCalled.value;\r\n\r\n      // next param\r\n      return param(paramCalled.error);\r\n    }\r\n\r\n    called[name] = paramCalled = {\r\n      error: null,\r\n      match: paramVal,\r\n      value: paramVal\r\n    };\r\n\r\n    paramCallback();\r\n  }\r\n\r\n  // single param callbacks\r\n  function paramCallback(err) {\r\n    var fn = paramCallbacks[paramIndex++];\r\n\r\n    // store updated value\r\n    paramCalled.value = req.params[key.name];\r\n\r\n    if (err) {\r\n      // store error\r\n      paramCalled.error = err;\r\n      param(err);\r\n      return;\r\n    }\r\n\r\n    if (!fn) return param();\r\n\r\n    try {\r\n      fn(req, res, paramCallback, paramVal, key.name);\r\n    } catch (e) {\r\n      paramCallback(e);\r\n    }\r\n  }\r\n\r\n  param();\r\n};\r\n\r\n/**\r\n * Use the given middleware function, with optional path, defaulting to \"/\".\r\n *\r\n * Use (like `.all`) will run for any http METHOD, but it will not add\r\n * handlers for those methods so OPTIONS requests will not consider `.use`\r\n * functions even if they could respond.\r\n *\r\n * The other difference is that _route_ path is stripped and not visible\r\n * to the handler function. The main effect of this feature is that mounted\r\n * handlers can operate without any code changes regardless of the \"prefix\"\r\n * pathname.\r\n *\r\n * @public\r\n */\r\n\r\nproto.use = function use(fn) {\r\n  var offset = 0;\r\n  var path = '/';\r\n\r\n  // default path to '/'\r\n  // disambiguate router.use([fn])\r\n  if (typeof fn !== 'function') {\r\n    var arg = fn;\r\n\r\n    while (Array.isArray(arg) && arg.length !== 0) {\r\n      arg = arg[0];\r\n    }\r\n\r\n    // first arg is the path\r\n    if (typeof arg !== 'function') {\r\n      offset = 1;\r\n      path = fn;\r\n    }\r\n  }\r\n\r\n  var callbacks = flatten(slice.call(arguments, offset));\r\n\r\n  if (callbacks.length === 0) {\r\n    throw new TypeError('Router.use() requires a middleware function')\r\n  }\r\n\r\n  for (var i = 0; i < callbacks.length; i++) {\r\n    var fn = callbacks[i];\r\n\r\n    if (typeof fn !== 'function') {\r\n      throw new TypeError('Router.use() requires a middleware function but got a ' + gettype(fn))\r\n    }\r\n\r\n    // add the middleware\r\n    debug('use %o %s', path, fn.name || '<anonymous>')\r\n\r\n    var layer = new Layer(path, {\r\n      sensitive: this.caseSensitive,\r\n      strict: false,\r\n      end: false\r\n    }, fn);\r\n\r\n    layer.route = undefined;\r\n\r\n    this.stack.push(layer);\r\n  }\r\n\r\n  return this;\r\n};\r\n\r\n/**\r\n * Create a new Route for the given path.\r\n *\r\n * Each route contains a separate middleware stack and VERB handlers.\r\n *\r\n * See the Route api documentation for details on adding handlers\r\n * and middleware to routes.\r\n *\r\n * @param {String} path\r\n * @return {Route}\r\n * @public\r\n */\r\n\r\nproto.route = function route(path) {\r\n  var route = new Route(path);\r\n\r\n  var layer = new Layer(path, {\r\n    sensitive: this.caseSensitive,\r\n    strict: this.strict,\r\n    end: true\r\n  }, route.dispatch.bind(route));\r\n\r\n  layer.route = route;\r\n\r\n  this.stack.push(layer);\r\n  return route;\r\n};\r\n\r\n// create Router#VERB functions\r\nmethods.concat('all').forEach(function(method){\r\n  proto[method] = function(path){\r\n    var route = this.route(path)\r\n    route[method].apply(route, slice.call(arguments, 1));\r\n    return this;\r\n  };\r\n});\r\n\r\n// append methods to a list of methods\r\nfunction appendMethods(list, addition) {\r\n  for (var i = 0; i < addition.length; i++) {\r\n    var method = addition[i];\r\n    if (list.indexOf(method) === -1) {\r\n      list.push(method);\r\n    }\r\n  }\r\n}\r\n\r\n// get pathname of request\r\nfunction getPathname(req) {\r\n  try {\r\n    return parseUrl(req).pathname;\r\n  } catch (err) {\r\n    return undefined;\r\n  }\r\n}\r\n\r\n// Get get protocol + host for a URL\r\nfunction getProtohost(url) {\r\n  if (typeof url !== 'string' || url.length === 0 || url[0] === '/') {\r\n    return undefined\r\n  }\r\n\r\n  var searchIndex = url.indexOf('?')\r\n  var pathLength = searchIndex !== -1\r\n    ? searchIndex\r\n    : url.length\r\n  var fqdnIndex = url.slice(0, pathLength).indexOf('://')\r\n\r\n  return fqdnIndex !== -1\r\n    ? url.substring(0, url.indexOf('/', 3 + fqdnIndex))\r\n    : undefined\r\n}\r\n\r\n// get type for error message\r\nfunction gettype(obj) {\r\n  var type = typeof obj;\r\n\r\n  if (type !== 'object') {\r\n    return type;\r\n  }\r\n\r\n  // inspect [[Class]] for objects\r\n  return toString.call(obj)\r\n    .replace(objectRegExp, '$1');\r\n}\r\n\r\n/**\r\n * Match path to a layer.\r\n *\r\n * @param {Layer} layer\r\n * @param {string} path\r\n * @private\r\n */\r\n\r\nfunction matchLayer(layer, path) {\r\n  try {\r\n    return layer.match(path);\r\n  } catch (err) {\r\n    return err;\r\n  }\r\n}\r\n\r\n// merge params with parent params\r\nfunction mergeParams(params, parent) {\r\n  if (typeof parent !== 'object' || !parent) {\r\n    return params;\r\n  }\r\n\r\n  // make copy of parent for base\r\n  var obj = mixin({}, parent);\r\n\r\n  // simple non-numeric merging\r\n  if (!(0 in params) || !(0 in parent)) {\r\n    return mixin(obj, params);\r\n  }\r\n\r\n  var i = 0;\r\n  var o = 0;\r\n\r\n  // determine numeric gaps\r\n  while (i in params) {\r\n    i++;\r\n  }\r\n\r\n  while (o in parent) {\r\n    o++;\r\n  }\r\n\r\n  // offset numeric indices in params before merge\r\n  for (i--; i >= 0; i--) {\r\n    params[i + o] = params[i];\r\n\r\n    // create holes for the merge when necessary\r\n    if (i < o) {\r\n      delete params[i];\r\n    }\r\n  }\r\n\r\n  return mixin(obj, params);\r\n}\r\n\r\n// restore obj props after function\r\nfunction restore(fn, obj) {\r\n  var props = new Array(arguments.length - 2);\r\n  var vals = new Array(arguments.length - 2);\r\n\r\n  for (var i = 0; i < props.length; i++) {\r\n    props[i] = arguments[i + 2];\r\n    vals[i] = obj[props[i]];\r\n  }\r\n\r\n  return function () {\r\n    // restore vals\r\n    for (var i = 0; i < props.length; i++) {\r\n      obj[props[i]] = vals[i];\r\n    }\r\n\r\n    return fn.apply(this, arguments);\r\n  };\r\n}\r\n\r\n// send an OPTIONS response\r\nfunction sendOptionsResponse(res, options, next) {\r\n  try {\r\n    var body = options.join(',');\r\n    res.set('Allow', body);\r\n    res.send(body);\r\n  } catch (err) {\r\n    next(err);\r\n  }\r\n}\r\n\r\n// wrap a function\r\nfunction wrap(old, fn) {\r\n  return function proxy() {\r\n    var args = new Array(arguments.length + 1);\r\n\r\n    args[0] = old;\r\n    for (var i = 0, len = arguments.length; i < len; i++) {\r\n      args[i + 1] = arguments[i];\r\n    }\r\n\r\n    fn.apply(this, args);\r\n  };\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}