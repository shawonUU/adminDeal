{"ast":null,"code":"/*!\r\n * express\r\n * Copyright(c) 2009-2013 TJ Holowaychuk\r\n * Copyright(c) 2013 Roman Shtylman\r\n * Copyright(c) 2014-2015 Douglas Christopher Wilson\r\n * MIT Licensed\r\n */\n'use strict';\n/**\r\n * Module dependencies.\r\n * @private\r\n */\n\nrequire(\"core-js/modules/web.immediate.js\");\n\nrequire(\"core-js/modules/es.error.cause.js\");\n\nvar debug = require('debug')('express:router:route');\n\nvar flatten = require('array-flatten');\n\nvar Layer = require('./layer');\n\nvar methods = require('methods');\n/**\r\n * Module variables.\r\n * @private\r\n */\n\n\nvar slice = Array.prototype.slice;\nvar toString = Object.prototype.toString;\n/**\r\n * Module exports.\r\n * @public\r\n */\n\nmodule.exports = Route;\n/**\r\n * Initialize `Route` with the given `path`,\r\n *\r\n * @param {String} path\r\n * @public\r\n */\n\nfunction Route(path) {\n  this.path = path;\n  this.stack = [];\n  debug('new %o', path); // route handlers for various http methods\n\n  this.methods = {};\n}\n/**\r\n * Determine if the route handles a given method.\r\n * @private\r\n */\n\n\nRoute.prototype._handles_method = function _handles_method(method) {\n  if (this.methods._all) {\n    return true;\n  }\n\n  var name = method.toLowerCase();\n\n  if (name === 'head' && !this.methods['head']) {\n    name = 'get';\n  }\n\n  return Boolean(this.methods[name]);\n};\n/**\r\n * @return {Array} supported HTTP methods\r\n * @private\r\n */\n\n\nRoute.prototype._options = function _options() {\n  var methods = Object.keys(this.methods); // append automatic head\n\n  if (this.methods.get && !this.methods.head) {\n    methods.push('head');\n  }\n\n  for (var i = 0; i < methods.length; i++) {\n    // make upper case\n    methods[i] = methods[i].toUpperCase();\n  }\n\n  return methods;\n};\n/**\r\n * dispatch req, res into this route\r\n * @private\r\n */\n\n\nRoute.prototype.dispatch = function dispatch(req, res, done) {\n  var idx = 0;\n  var stack = this.stack;\n  var sync = 0;\n\n  if (stack.length === 0) {\n    return done();\n  }\n\n  var method = req.method.toLowerCase();\n\n  if (method === 'head' && !this.methods['head']) {\n    method = 'get';\n  }\n\n  req.route = this;\n  next();\n\n  function next(err) {\n    // signal to exit route\n    if (err && err === 'route') {\n      return done();\n    } // signal to exit router\n\n\n    if (err && err === 'router') {\n      return done(err);\n    }\n\n    var layer = stack[idx++];\n\n    if (!layer) {\n      return done(err);\n    } // max sync stack\n\n\n    if (++sync > 100) {\n      return setImmediate(next, err);\n    }\n\n    if (layer.method && layer.method !== method) {\n      return next(err);\n    }\n\n    if (err) {\n      layer.handle_error(err, req, res, next);\n    } else {\n      layer.handle_request(req, res, next);\n    }\n\n    sync = 0;\n  }\n};\n/**\r\n * Add a handler for all HTTP verbs to this route.\r\n *\r\n * Behaves just like middleware and can respond or call `next`\r\n * to continue processing.\r\n *\r\n * You can use multiple `.all` call to add multiple handlers.\r\n *\r\n *   function check_something(req, res, next){\r\n *     next();\r\n *   };\r\n *\r\n *   function validate_user(req, res, next){\r\n *     next();\r\n *   };\r\n *\r\n *   route\r\n *   .all(validate_user)\r\n *   .all(check_something)\r\n *   .get(function(req, res, next){\r\n *     res.send('hello world');\r\n *   });\r\n *\r\n * @param {function} handler\r\n * @return {Route} for chaining\r\n * @api public\r\n */\n\n\nRoute.prototype.all = function all() {\n  var handles = flatten(slice.call(arguments));\n\n  for (var i = 0; i < handles.length; i++) {\n    var handle = handles[i];\n\n    if (typeof handle !== 'function') {\n      var type = toString.call(handle);\n      var msg = 'Route.all() requires a callback function but got a ' + type;\n      throw new TypeError(msg);\n    }\n\n    var layer = Layer('/', {}, handle);\n    layer.method = undefined;\n    this.methods._all = true;\n    this.stack.push(layer);\n  }\n\n  return this;\n};\n\nmethods.forEach(function (method) {\n  Route.prototype[method] = function () {\n    var handles = flatten(slice.call(arguments));\n\n    for (var i = 0; i < handles.length; i++) {\n      var handle = handles[i];\n\n      if (typeof handle !== 'function') {\n        var type = toString.call(handle);\n        var msg = 'Route.' + method + '() requires a callback function but got a ' + type;\n        throw new Error(msg);\n      }\n\n      debug('%s %o', method, this.path);\n      var layer = Layer('/', {}, handle);\n      layer.method = method;\n      this.methods[method] = true;\n      this.stack.push(layer);\n    }\n\n    return this;\n  };\n});","map":{"version":3,"names":["debug","require","flatten","Layer","methods","slice","Array","prototype","toString","Object","module","exports","Route","path","stack","_handles_method","method","_all","name","toLowerCase","Boolean","_options","keys","get","head","push","i","length","toUpperCase","dispatch","req","res","done","idx","sync","route","next","err","layer","setImmediate","handle_error","handle_request","all","handles","call","arguments","handle","type","msg","TypeError","undefined","forEach","Error"],"sources":["E:/adminDeal/node_modules/express/lib/router/route.js"],"sourcesContent":["/*!\r\n * express\r\n * Copyright(c) 2009-2013 TJ Holowaychuk\r\n * Copyright(c) 2013 Roman Shtylman\r\n * Copyright(c) 2014-2015 Douglas Christopher Wilson\r\n * MIT Licensed\r\n */\r\n\r\n'use strict';\r\n\r\n/**\r\n * Module dependencies.\r\n * @private\r\n */\r\n\r\nvar debug = require('debug')('express:router:route');\r\nvar flatten = require('array-flatten');\r\nvar Layer = require('./layer');\r\nvar methods = require('methods');\r\n\r\n/**\r\n * Module variables.\r\n * @private\r\n */\r\n\r\nvar slice = Array.prototype.slice;\r\nvar toString = Object.prototype.toString;\r\n\r\n/**\r\n * Module exports.\r\n * @public\r\n */\r\n\r\nmodule.exports = Route;\r\n\r\n/**\r\n * Initialize `Route` with the given `path`,\r\n *\r\n * @param {String} path\r\n * @public\r\n */\r\n\r\nfunction Route(path) {\r\n  this.path = path;\r\n  this.stack = [];\r\n\r\n  debug('new %o', path)\r\n\r\n  // route handlers for various http methods\r\n  this.methods = {};\r\n}\r\n\r\n/**\r\n * Determine if the route handles a given method.\r\n * @private\r\n */\r\n\r\nRoute.prototype._handles_method = function _handles_method(method) {\r\n  if (this.methods._all) {\r\n    return true;\r\n  }\r\n\r\n  var name = method.toLowerCase();\r\n\r\n  if (name === 'head' && !this.methods['head']) {\r\n    name = 'get';\r\n  }\r\n\r\n  return Boolean(this.methods[name]);\r\n};\r\n\r\n/**\r\n * @return {Array} supported HTTP methods\r\n * @private\r\n */\r\n\r\nRoute.prototype._options = function _options() {\r\n  var methods = Object.keys(this.methods);\r\n\r\n  // append automatic head\r\n  if (this.methods.get && !this.methods.head) {\r\n    methods.push('head');\r\n  }\r\n\r\n  for (var i = 0; i < methods.length; i++) {\r\n    // make upper case\r\n    methods[i] = methods[i].toUpperCase();\r\n  }\r\n\r\n  return methods;\r\n};\r\n\r\n/**\r\n * dispatch req, res into this route\r\n * @private\r\n */\r\n\r\nRoute.prototype.dispatch = function dispatch(req, res, done) {\r\n  var idx = 0;\r\n  var stack = this.stack;\r\n  var sync = 0\r\n\r\n  if (stack.length === 0) {\r\n    return done();\r\n  }\r\n\r\n  var method = req.method.toLowerCase();\r\n  if (method === 'head' && !this.methods['head']) {\r\n    method = 'get';\r\n  }\r\n\r\n  req.route = this;\r\n\r\n  next();\r\n\r\n  function next(err) {\r\n    // signal to exit route\r\n    if (err && err === 'route') {\r\n      return done();\r\n    }\r\n\r\n    // signal to exit router\r\n    if (err && err === 'router') {\r\n      return done(err)\r\n    }\r\n\r\n    var layer = stack[idx++];\r\n    if (!layer) {\r\n      return done(err);\r\n    }\r\n\r\n    // max sync stack\r\n    if (++sync > 100) {\r\n      return setImmediate(next, err)\r\n    }\r\n\r\n    if (layer.method && layer.method !== method) {\r\n      return next(err);\r\n    }\r\n\r\n    if (err) {\r\n      layer.handle_error(err, req, res, next);\r\n    } else {\r\n      layer.handle_request(req, res, next);\r\n    }\r\n\r\n    sync = 0\r\n  }\r\n};\r\n\r\n/**\r\n * Add a handler for all HTTP verbs to this route.\r\n *\r\n * Behaves just like middleware and can respond or call `next`\r\n * to continue processing.\r\n *\r\n * You can use multiple `.all` call to add multiple handlers.\r\n *\r\n *   function check_something(req, res, next){\r\n *     next();\r\n *   };\r\n *\r\n *   function validate_user(req, res, next){\r\n *     next();\r\n *   };\r\n *\r\n *   route\r\n *   .all(validate_user)\r\n *   .all(check_something)\r\n *   .get(function(req, res, next){\r\n *     res.send('hello world');\r\n *   });\r\n *\r\n * @param {function} handler\r\n * @return {Route} for chaining\r\n * @api public\r\n */\r\n\r\nRoute.prototype.all = function all() {\r\n  var handles = flatten(slice.call(arguments));\r\n\r\n  for (var i = 0; i < handles.length; i++) {\r\n    var handle = handles[i];\r\n\r\n    if (typeof handle !== 'function') {\r\n      var type = toString.call(handle);\r\n      var msg = 'Route.all() requires a callback function but got a ' + type\r\n      throw new TypeError(msg);\r\n    }\r\n\r\n    var layer = Layer('/', {}, handle);\r\n    layer.method = undefined;\r\n\r\n    this.methods._all = true;\r\n    this.stack.push(layer);\r\n  }\r\n\r\n  return this;\r\n};\r\n\r\nmethods.forEach(function(method){\r\n  Route.prototype[method] = function(){\r\n    var handles = flatten(slice.call(arguments));\r\n\r\n    for (var i = 0; i < handles.length; i++) {\r\n      var handle = handles[i];\r\n\r\n      if (typeof handle !== 'function') {\r\n        var type = toString.call(handle);\r\n        var msg = 'Route.' + method + '() requires a callback function but got a ' + type\r\n        throw new Error(msg);\r\n      }\r\n\r\n      debug('%s %o', method, this.path)\r\n\r\n      var layer = Layer('/', {}, handle);\r\n      layer.method = method;\r\n\r\n      this.methods[method] = true;\r\n      this.stack.push(layer);\r\n    }\r\n\r\n    return this;\r\n  };\r\n});\r\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}